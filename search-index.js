crystal_doc_search_index_callback({"repository_name":"chatgpt-cli","body":"# ChatGPT CLI\n\n[![build](https://github.com/kojix2/chatgpt-cli/actions/workflows/build.yml/badge.svg)](https://github.com/kojix2/chatgpt-cli/actions/workflows/build.yml)\n\nChatGPT CLI is a command-line interface tool for interacting with OpenAI's [ChatGPT API](https://platform.openai.com/docs/api-reference/chat). It allows users to communicate with the GPT model, adjust API parameters, use magic commands, insert file contents, fetch content from URLs, and execute system commands while chatting.\n\n## Features\n\n- Interactive command-line interface using GNU Readline.\n- Expand file contents from the file path(s) using the placeholder.\n- Expand web page contents from the URL using the placeholder.\n- Magic commands to `clear`, `undo`, `edit`, `write`, `save`, and `load` data.\n- Execute system commands and pass captured stdout and stderr output to ChatGPT.\n- Code blocks in the response are saved in temp files and can be referenced from `$CODE1`, `$CODE2`...\n- Output execution results as HTML (experimental).\n- Substitution patterns of placeholders can be configurable in the configuration file.\n\n## Installation\n\n1. Install [Crystal](https://github.com/crystal-lang/crystal)\n2. Build the project:\n\n   ```bash\n   git clone https://github.com/kojix2/chatgpt-cli\n   cd chatgpt-cli\n   make\n   sudo make install\n   ```\n\n3. Set your [OpenAI API key](https://platform.openai.com/account/api-keys) as an environment variable:\n\n   ```bash\n   export OPENAI_API_KEY=\"your_openai_api_key\"\n   ```\n\n## Usage\n\nTo start using ChatGPT CLI, run the `chatgpt` command in your terminal:\n\n```bash\nchatgpt\n```\n\nType a message and press Enter to get a response from GPT-3.5 Turbo. To exit, type `exit`, `quit`, or press `Ctrl + D`.\n\n### Options\n\nYou can set various options when running the `chatgpt` command:\n\n```\nUsage: bin/chatgpt [options]\n    -m MODEL, --model MODEL          Model name [gpt-3.5-turbo]\n    -i ID, --id ID                   ID of the custom system message\n    -s STR, --system STR             System message\n    -n INT                           Number of edits to generate [1]\n    -t Float, --temperature Float    Sampling temperature to use [1.0]\n    -p Float, --top_p Float          Probability threshold of nucleus sampling [1.0]\n    -v, --version                    Print version info and exit\n    -h, --help                       Print help\n```\n\n### Selecting ChatGPT System Commands\n\nSelect pre-registered system commands:\n\n```bash\nchatgpt -i code\n```\n\nDepending on how you use it, system commands are not always necessary. It works well without them.\nTo edit system commands, edit the config file. Type `%config` to open a text editor. \n`code`, `edit`, `poet`, `tran` are available by default.\n\n### Passing Files to ChatGPT\n\nYou can pass the contents of files to ChatGPT by using the `%{foo.txt}` pattern.\n\n```\n> Please explain the following code: %{src/beatles.py} Are there any bugs?\n```\n\nWith this feature, you can pass the code to ChatGPT and have them write README.md.\n\n```\n> Please read the code of the tool: %{src/*.cr} %{src/**/*.cr} Then update README.md %{README.md}\n...\n> %w README.md # This will save README.md\n```\n\nNote: READMEs created this way tend to be characterless. Still, it is marvelous to have a computer write the README for you.\n\n### Passing Web Pages to ChatGPT\n\nYou can pass the contents of a web page to ChatGPT by using `%{www.example.com}`.\n\n```\n> Pick five interesting news items: %%{https://news.ycombinator.com/}\n```\n\nHere, the HTML from the URL is fetched, the words used in the `body` are extracted and passed to ChatGPT. It is much smaller than the raw HTML, but still not enough.\n\n### Magic Commands\n\nDuring the dialogue, you can use a variety of magic commands.\n\n```\n%clear\n```\n\nClear all messages. This is useful when you want to change the topic and set TOKEN back to zero.\n\n```\n%undo <n>\n```\n\nUndo the last n query and response [1]. If you make a mistake asking ChatGPT or if the reply is not what you are looking for, you can undo.\n\n```\n%write <filename>\n```\n\nWrite the most recent message to a file. Save the text and scripts written by ChatGPT.\n\n```\n%w <filename>\n```\n\nAlias for `write`. This magic command is used so often that an alias is provided.\n\n```\n%config\n```\n\nEdit the config file. Open a text editor and rewrite the settings.\n\n```\n%system\n```\n\nShow the current system message. \n\n```\n%system <message>\n```\n\nSet a new system message (this behavior is subject to change).\n\n```\n%edit\n```\n\nEdit data in JSON format. All data passed to ChatGPT can be edited here. You are free to tamper with the past.\n\n```\n%html <filename>\n```\n\nExport the conversation to HTML and launch your browser. This feature is useful when you want to save a conversation or check path expansion, etc. (Experimental and the output HTML may not be correct)\n\n```\n%save <filename>\n```\n\nSave the data. This allows you to do things like \"save session\". The file is a JSON file to be posted to ChatGPT.\n\n```\n%load <filename>\n```\n\nLoad the data. This allows you to do things like \"load session\".\n\n```\n%resume\n```\n\nLoad data from auto-saved data file. We humans forget to save data. Therefore, the last session is automatically saved.\n\n```\n%tokens\n```\n\nTotal tokens used. You will see a more detailed number of TOKENs than is shown in the prompt. Please note that chatgpt-cli does not have the ability to calculate the number of TOKENs. It only displays the ChatGPT response. Therefore, if any edits may have been made, it will be Unknown.\n\n```\n%webapp\n```\n\nOpen the ChatGPT website.\n\n```\n%debug\n```\n\nShow debug message. Display the data actually posted to ChatGPT and the response in JSON format.\n\n```\n%help\n```\n\nShow the help. Humans forget commands.\n\nNote that for `%config`, `%data`, and other commands launch an editor. The editor used can be set by the `EDITOR` environment variable.\nNote that the tool is still being improved and the behavior of the magic commands will continue to change.\n\n### Executing System Commands\n\nYou can execute system commands while chatting by prefixing the command with the `!` symbol. \n\nExecute a command, and display the output immediately:\n\n```bash\n> !pwd\n```\n\nThis way you can also run commands like `vim` and `top`.\n\n#### Capture STDOUT and STDERR\n\nCapture the output of a command for later use:\n\n```bash\n> !!git diff\n```\n\nThe standard output can be inserted into the chat with `%STDOUT`.\n\n```\n> Please write a commit message: %STDOUT\n```\n\nThe results can be referenced through the environment variable `RESP` (experimental).\n\n```\n> !git commit -m \"$RESP\"\n```\n\nThe contents of the standard error output can also be inserted into the chat with `%STDERR`.\n\n```bash\n> !!wrong_command\n\n```\n\n```\n> Explain the meaning of this error message: %STDERR\n```\n\nYou can also use `!{ cmd }`. In this case, it will be replaced by the contents of standard input\n\n```\n> What time is it now? Hint: !{date}\n```\n\n#### Run Code Blocks in the Response\n\nWhen ChatGPT returns code blocks, ChatGPT CLI saves these blocks temporarily and assigns them to environment variables named `CODE1`, `CODE2`, ... and so on. This allows you to execute the code blocks on your computer. \n\n````md\n> Write code to display 1 to 10 in Python and Ruby.\n> Python:\n\n```\nfor i in range(1, 11):\n    print(i)\n```\n\nRuby:\n\n```\n(1..10).each { |i| puts i }\n```\n\n> ! python $CODE1\n> ! ruby $CODE2\n````\n\n## Configuration\n\nThe system messages used by ChatGPT CLI can be customized through the `config.json` file. The file is located in `~/.config/chatgpt-cli/` by default.\nType `%config`. \n\nConfiguration files are often changed to make more items configurable. Please see config.json in the repository for the latest information.\n\n## Uninstallation\n\nChatGPT CLI uses the following 3 files and directories. This is all there is to it.\n\n```sh\nrm /usr/local/bin/chatgpt   # Remove the executable\nrm -r ~/.config/chatgpt-cli # Remove the config directory\nrm ~/.chatgpt_history       # Remove command history\n```\n\n## Contributing\n\nBug reports and pull requests are welcome on GitHub at [https://github.com/kojix2/chatgpt-cli](https://github.com/kojix2/chatgpt-cli).\n\n## Development\n\n```bash\ngit clone https://github.com/kojix2/chatgpt-cli\ncd chatgpt-cli\nshards install\nshards build --release\nbin/chatgpt\n```\n\nWhat is a good way to distribute command-line tools created in Crystal? I am looking for someone to help us.\n\nYou can quickly try development by using [Gitpod](https://www.gitpod.io/).\n\n## License\n\nThis project is open-source and available under the terms of the [MIT License](https://opensource.org/licenses/MIT).\n\n","program":{"html_id":"chatgpt-cli/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"chatgpt-cli","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"chatgpt-cli/ChatGPT","path":"ChatGPT.html","kind":"module","full_name":"ChatGPT","name":"ChatGPT","abstract":false,"locations":[{"filename":"src/chatgpt.cr","line_number":3,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt.cr#L3"},{"filename":"src/chatgpt/cli.cr","line_number":20,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L20"},{"filename":"src/chatgpt/cli/parser.cr","line_number":5,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/parser.cr#L5"},{"filename":"src/chatgpt/cli/version.cr","line_number":1,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/version.cr#L1"},{"filename":"src/chatgpt/client.cr","line_number":3,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L3"},{"filename":"src/chatgpt/config.cr","line_number":3,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L3"},{"filename":"src/chatgpt/file_extensions.cr","line_number":1,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/file_extensions.cr#L1"},{"filename":"src/chatgpt/input_substitutor.cr","line_number":3,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/input_substitutor.cr#L3"},{"filename":"src/chatgpt/magic_command_runner.cr","line_number":5,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L5"},{"filename":"src/chatgpt/post_data.cr","line_number":3,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L3"},{"filename":"src/chatgpt/response_data.cr","line_number":3,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/response_data.cr#L3"},{"filename":"src/chatgpt/system_command_runner.cr","line_number":1,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/system_command_runner.cr#L1"},{"filename":"src/chatgpt/webpage_compressor.cr","line_number":7,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/webpage_compressor.cr#L7"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DEBUG_FLAG","name":"DEBUG_FLAG","value":"[false]"},{"id":"FILE_EXTENSIONS","name":"FILE_EXTENSIONS","value":"{\".c\" => \"c\", \".cr\" => \"crystal\", \".cpp\" => \"cpp\", \".cs\" => \"csharp\", \".css\" => \"css\", \".go\" => \"go\", \".html\" => \"html\", \".htm\" => \"html\", \".java\" => \"java\", \".js\" => \"javascript\", \".json\" => \"json\", \".kt\" => \"kotlin\", \".lua\" => \"lua\", \".md\" => \"md\", \".markdown\" => \"markdown\", \".m\" => \"matlab\", \".nim\" => \"nim\", \".pl\" => \"perl\", \".php\" => \"php\", \".py\" => \"python\", \".R\" => \"r\", \".rb\" => \"ruby\", \".rs\" => \"rust\", \".scala\" => \"scala\", \".sh\" => \"shell\", \".sql\" => \"sql\", \".swift\" => \"swift\", \".ts\" => \"typescript\", \".xml\" => \"xml\", \".yaml\" => \"yaml\", \".yml\" => \"yaml\"}"}],"types":[{"html_id":"chatgpt-cli/ChatGPT/ApiKeyError","path":"ChatGPT/ApiKeyError.html","kind":"class","full_name":"ChatGPT::ApiKeyError","name":"ApiKeyError","abstract":false,"superclass":{"html_id":"chatgpt-cli/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"chatgpt-cli/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/client.cr","line_number":4,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L4"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"}},{"html_id":"chatgpt-cli/ChatGPT/CLI","path":"ChatGPT/CLI.html","kind":"class","full_name":"ChatGPT::CLI","name":"CLI","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/cli.cr","line_number":21,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L21"},{"filename":"src/chatgpt/cli/parser.cr","line_number":6,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/parser.cr#L6"},{"filename":"src/chatgpt/cli/version.cr","line_number":2,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/version.cr#L2"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SOURCE_URL","name":"SOURCE_URL","value":"\"https://github.com/kojix2/chatgpt-cli\""},{"id":"VERSION","name":"VERSION","value":"{{ (`shards version /home/runner/work/chatgpt-cli/chatgpt-cli/src/chatgpt/cli`).chomp.stringify }}"}],"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":33,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L33"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"chat_gpt_client:ChatGPT::Client-instance-method","name":"chat_gpt_client","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":23,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L23"},"def":{"name":"chat_gpt_client","visibility":"Public","body":"@chat_gpt_client"}},{"html_id":"code_blocks:Array(File)-instance-method","name":"code_blocks","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":31,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L31"},"def":{"name":"code_blocks","return_type":"Array(File)","visibility":"Public","body":"@code_blocks"}},{"html_id":"interactive:Bool-instance-method","name":"interactive","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":24,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L24"},"def":{"name":"interactive","return_type":"Bool","visibility":"Public","body":"@interactive"}},{"html_id":"magic_command_runner:ChatGPT::MagicCommandRunner-instance-method","name":"magic_command_runner","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":26,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L26"},"def":{"name":"magic_command_runner","visibility":"Public","body":"@magic_command_runner"}},{"html_id":"main_run(input_msg)-instance-method","name":"main_run","abstract":false,"args":[{"name":"input_msg","external_name":"input_msg","restriction":""}],"args_string":"(input_msg)","args_html":"(input_msg)","location":{"filename":"src/chatgpt/cli.cr","line_number":88,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L88"},"def":{"name":"main_run","args":[{"name":"input_msg","external_name":"input_msg","restriction":""}],"visibility":"Public","body":"if try_system_command(input_msg)\n  return\nend\nif try_magic_command(input_msg)\n  return\nend\ninput_msg = substitute(input_msg)\npost_data.add_message(\"user\", input_msg)\nbegin\n  response = chat_gpt_client.send_chat_request(post_data)\nrescue ex\n  STDERR.puts(\"Error: #{ex.message}\"._colorize(:warning, :bold))\n  post_data.messages.pop\n  return\nend\nif response.success?\n  @response_data = ResponseData.new(response.body)\n  result_msg = response_data.assistant_message\n  post_data.add_message(\"assistant\", result_msg)\n  File.write(Config::POST_DATA_FILE, post_data.to_pretty_json)\n  set_response_env(result_msg, \"RESP\")\n  extract_code_blocks(result_msg)\n  @total_tokens = response_data.total_tokens\n  puts(result_msg._colorize(:chatgpt))\nelse\n  display_errors(response)\n  post_data.messages.pop\nend\n"}},{"html_id":"post_data:PostData-instance-method","name":"post_data","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":22,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L22"},"def":{"name":"post_data","return_type":"PostData","visibility":"Public","body":"@post_data"}},{"html_id":"response_data:ResponseData-instance-method","name":"response_data","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":29,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L29"},"def":{"name":"response_data","return_type":"ResponseData","visibility":"Public","body":"@response_data"}},{"html_id":"run-instance-method","name":"run","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":58,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L58"},"def":{"name":"run","visibility":"Public","body":"if @interactive\n  run_interacitively\nelse\n  run_as_oneliner\nend"}},{"html_id":"run_as_oneliner-instance-method","name":"run_as_oneliner","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":66,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L66"},"def":{"name":"run_as_oneliner","visibility":"Public","body":"input_msg = ARGF.gets_to_end\npost_data.add_message(\"user\", input_msg)\nadd_history(input_msg)\nmain_run(input_msg)\n"}},{"html_id":"run_interacitively-instance-method","name":"run_interacitively","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":73,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L73"},"def":{"name":"run_interacitively","visibility":"Public","body":"LibReadline.read_history(Config::HISTORY_FILE)\nloop do\n  input_msg = Readline.readline(readline_prompt, true)\n  if input_msg.nil?\n    break\n  end\n  if input_msg.empty?\n    next\n  end\n  add_history(input_msg)\n  if [\"exit\", \"quit\"].includes?(input_msg)\n    break\n  end\n  main_run(input_msg)\nend\n"}},{"html_id":"substitutor:ChatGPT::InputSubstitutor-instance-method","name":"substitutor","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":27,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L27"},"def":{"name":"substitutor","visibility":"Public","body":"@substitutor"}},{"html_id":"system_command_runner:ChatGPT::SystemCommandRunner-instance-method","name":"system_command_runner","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":25,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L25"},"def":{"name":"system_command_runner","visibility":"Public","body":"@system_command_runner"}},{"html_id":"total_tokens:Int32-instance-method","name":"total_tokens","abstract":false,"location":{"filename":"src/chatgpt/cli.cr","line_number":30,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli.cr#L30"},"def":{"name":"total_tokens","return_type":"Int32","visibility":"Public","body":"@total_tokens"}}],"types":[{"html_id":"chatgpt-cli/ChatGPT/CLI/Parser","path":"ChatGPT/CLI/Parser.html","kind":"class","full_name":"ChatGPT::CLI::Parser","name":"Parser","abstract":false,"superclass":{"html_id":"chatgpt-cli/OptionParser","kind":"class","full_name":"OptionParser","name":"OptionParser"},"ancestors":[{"html_id":"chatgpt-cli/OptionParser","kind":"class","full_name":"OptionParser","name":"OptionParser"},{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/cli/parser.cr","line_number":7,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/parser.cr#L7"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/ChatGPT/CLI","kind":"class","full_name":"ChatGPT::CLI","name":"CLI"},"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/chatgpt/cli/parser.cr","line_number":11,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/parser.cr#L11"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"data:PostData-instance-method","name":"data","abstract":false,"location":{"filename":"src/chatgpt/cli/parser.cr","line_number":8,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/parser.cr#L8"},"def":{"name":"data","return_type":"PostData","visibility":"Public","body":"@data"}},{"html_id":"interactive:Bool-instance-method","name":"interactive","abstract":false,"location":{"filename":"src/chatgpt/cli/parser.cr","line_number":9,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/parser.cr#L9"},"def":{"name":"interactive","return_type":"Bool","visibility":"Public","body":"@interactive"}},{"html_id":"load_session(filename)-instance-method","name":"load_session","abstract":false,"args":[{"name":"filename","external_name":"filename","restriction":""}],"args_string":"(filename)","args_html":"(filename)","location":{"filename":"src/chatgpt/cli/parser.cr","line_number":63,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/cli/parser.cr#L63"},"def":{"name":"load_session","args":[{"name":"filename","external_name":"filename","restriction":""}],"visibility":"Public","body":"begin\n  @data = PostData.from_json(File.read(filename))\nrescue\n  STDERR.puts(\"Error: Loading session failed (#{filename})\")\nend"}}]}]},{"html_id":"chatgpt-cli/ChatGPT/Client","path":"ChatGPT/Client.html","kind":"class","full_name":"ChatGPT::Client","name":"Client","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/client.cr","line_number":8,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L8"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"API_ENDPOINT","name":"API_ENDPOINT","value":"\"https://api.openai.com\""}],"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/chatgpt/client.cr","line_number":13,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L13"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"build_http_headers-instance-method","name":"build_http_headers","abstract":false,"location":{"filename":"src/chatgpt/client.cr","line_number":17,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L17"},"def":{"name":"build_http_headers","visibility":"Public","body":"HTTP::Headers {\"Authorization\" => \"Bearer #{fetch_api_key}\", \"Content-Type\" => \"application/json\"}"}},{"html_id":"fetch_api_key-instance-method","name":"fetch_api_key","abstract":false,"location":{"filename":"src/chatgpt/client.cr","line_number":24,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L24"},"def":{"name":"fetch_api_key","visibility":"Public","body":"if ENV.has_key?(\"OPENAI_API_KEY\")\n  ENV[\"OPENAI_API_KEY\"]\nelse\n  STDERR.puts(\"Error: OPENAI_API_KEY is not set. \"._colorize(:warning, :bold))\n  STDERR.puts(\"Please get your API key and set it as an environment variable.\"._colorize(:warning))\n  \"\"\nend"}},{"html_id":"post_request(request_data)-instance-method","name":"post_request","abstract":false,"args":[{"name":"request_data","external_name":"request_data","restriction":""}],"args_string":"(request_data)","args_html":"(request_data)","location":{"filename":"src/chatgpt/client.cr","line_number":49,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L49"},"def":{"name":"post_request","args":[{"name":"request_data","external_name":"request_data","restriction":""}],"visibility":"Public","body":"begin\n  client = HTTP::Client.new(URI.parse(API_ENDPOINT))\n  Signal::INT.trap do |s|\n    client.close\n  end\n  response = client.post(\"/v1/chat/completions\", headers: @http_headers, body: request_data.to_json)\nrescue ex\n  Signal::INT.reset\n  raise(ex)\nend"}},{"html_id":"send_chat_request(request_data)-instance-method","name":"send_chat_request","abstract":false,"args":[{"name":"request_data","external_name":"request_data","restriction":""}],"args_string":"(request_data)","args_html":"(request_data)","location":{"filename":"src/chatgpt/client.cr","line_number":34,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L34"},"def":{"name":"send_chat_request","args":[{"name":"request_data","external_name":"request_data","restriction":""}],"visibility":"Public","body":"if debug_mode?\n  log_request_data(request_data)\nend\nspinner = create_spinner\nspinner.start\nbegin\n  chat_response = post_request(request_data)\nrescue ex\n  spinner.stop\n  raise(ex)\nend\nspinner.stop\nif debug_mode?\n  log_response_data(chat_response)\nend\nchat_response\n"}}]},{"html_id":"chatgpt-cli/ChatGPT/Config","path":"ChatGPT/Config.html","kind":"class","full_name":"ChatGPT::Config","name":"Config","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/config.cr","line_number":4,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L4"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"BASE_DIR","name":"BASE_DIR","value":"if ENV.has_key?(\"CHATGPT_CLI_CONFIG\")\n  ENV[\"CHATGPT_CLI_CONFIG\"]\nelse\n  \"#{ENV[\"HOME\"]}/.config/chatgpt-cli\"\nend"},{"id":"CONFIG_FILE","name":"CONFIG_FILE","value":"\"#{BASE_DIR}/config.json\""},{"id":"DEFAULT_CONFIG","name":"DEFAULT_CONFIG","value":"{{ (`cat /home/runner/work/chatgpt-cli/chatgpt-cli/src/chatgpt/../../config.json`).chomp.stringify }}"},{"id":"HISTORY_FILE","name":"HISTORY_FILE","value":"\"#{ENV[\"HOME\"]}/.chatgpt_history\""},{"id":"POST_DATA_FILE","name":"POST_DATA_FILE","value":"\"#{BASE_DIR}/post_data.json\""}],"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"class_methods":[{"html_id":"instance-class-method","name":"instance","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":21,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L21"},"def":{"name":"instance","visibility":"Public","body":"@@instance || (@@instance = new)"}}],"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":25,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L25"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"add_message(id,role,content)-instance-method","name":"add_message","abstract":false,"args":[{"name":"id","external_name":"id","restriction":""},{"name":"role","external_name":"role","restriction":""},{"name":"content","external_name":"content","restriction":""}],"args_string":"(id, role, content)","args_html":"(id, role, content)","location":{"filename":"src/chatgpt/config.cr","line_number":55,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L55"},"def":{"name":"add_message","args":[{"name":"id","external_name":"id","restriction":""},{"name":"role","external_name":"role","restriction":""},{"name":"content","external_name":"content","restriction":""}],"visibility":"Public","body":"config_data[\"system_messages\"][id] = {\"role\" => role.to_s, \"content\" => content.to_s}"}},{"html_id":"add_system_message(id,content)-instance-method","name":"add_system_message","abstract":false,"args":[{"name":"id","external_name":"id","restriction":""},{"name":"content","external_name":"content","restriction":""}],"args_string":"(id, content)","args_html":"(id, content)","location":{"filename":"src/chatgpt/config.cr","line_number":62,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L62"},"def":{"name":"add_system_message","args":[{"name":"id","external_name":"id","restriction":""},{"name":"content","external_name":"content","restriction":""}],"visibility":"Public","body":"add_message(id, \"system\", content)"}},{"html_id":"color(id:Symbol)-instance-method","name":"color","abstract":false,"args":[{"name":"id","external_name":"id","restriction":"Symbol"}],"args_string":"(id : Symbol)","args_html":"(id : Symbol)","location":{"filename":"src/chatgpt/config.cr","line_number":77,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L77"},"def":{"name":"color","args":[{"name":"id","external_name":"id","restriction":"Symbol"}],"visibility":"Public","body":"default = @config_data_default[\"terminal_colors\"][id.to_s]\nterminal_colors.fetch(id.to_s, default)\n"}},{"html_id":"command_regex-instance-method","name":"command_regex","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":100,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L100"},"def":{"name":"command_regex","visibility":"Public","body":"Regex.new((pattern(:command))[\"pattern\"])"}},{"html_id":"config_data:ConfigData-instance-method","name":"config_data","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":19,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L19"},"def":{"name":"config_data","return_type":"ConfigData","visibility":"Public","body":"@config_data"}},{"html_id":"create_default_config-instance-method","name":"create_default_config","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":46,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L46"},"def":{"name":"create_default_config","visibility":"Public","body":"@config_data = ConfigData.from_json(DEFAULT_CONFIG)\nsave\n"}},{"html_id":"file_regex-instance-method","name":"file_regex","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":108,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L108"},"def":{"name":"file_regex","visibility":"Public","body":"Regex.new((pattern(:file))[\"pattern\"])"}},{"html_id":"load_config-instance-method","name":"load_config","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":31,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L31"},"def":{"name":"load_config","visibility":"Public","body":"if File.exists?(CONFIG_FILE)\n  begin\n    File.open(CONFIG_FILE) do |f|\n      @config_data = ConfigData.from_json(f)\n    end\n  rescue ex\n    STDERR.puts(\"Error: #{ex}\".colorize(:red))\n    STDERR.puts(\"Failed to load config at #{CONFIG_FILE}\")\n  end\nelse\n  create_default_config\nend"}},{"html_id":"pattern(id:Symbol)-instance-method","name":"pattern","abstract":false,"args":[{"name":"id","external_name":"id","restriction":"Symbol"}],"args_string":"(id : Symbol)","args_html":"(id : Symbol)","location":{"filename":"src/chatgpt/config.cr","line_number":87,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L87"},"def":{"name":"pattern","args":[{"name":"id","external_name":"id","restriction":"Symbol"}],"visibility":"Public","body":"default = @config_data_default[\"substitute_patterns\"][id.to_s]\nsubstitute_patterns.fetch(id.to_s, default)\n"}},{"html_id":"save-instance-method","name":"save","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":66,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L66"},"def":{"name":"save","visibility":"Public","body":"overwrite = File.exists?(CONFIG_FILE)\nFile.write(CONFIG_FILE, config_data.to_pretty_json)\nSTDERR.puts(\"#{overwrite ? \"Overwrote\" : \"Created\"} config at #{CONFIG_FILE}\")\n"}},{"html_id":"select_id(id)-instance-method","name":"select_id","abstract":false,"args":[{"name":"id","external_name":"id","restriction":""}],"args_string":"(id)","args_html":"(id)","location":{"filename":"src/chatgpt/config.cr","line_number":51,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L51"},"def":{"name":"select_id","args":[{"name":"id","external_name":"id","restriction":""}],"visibility":"Public","body":"(@config_data.dig(\"system_messages\", id)).as(Hash(String, String))"}},{"html_id":"stderr_regex-instance-method","name":"stderr_regex","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":96,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L96"},"def":{"name":"stderr_regex","visibility":"Public","body":"Regex.new((pattern(:stderr))[\"pattern\"])"}},{"html_id":"stdout_regex-instance-method","name":"stdout_regex","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":92,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L92"},"def":{"name":"stdout_regex","visibility":"Public","body":"Regex.new((pattern(:stdout))[\"pattern\"])"}},{"html_id":"substitute_patterns-instance-method","name":"substitute_patterns","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":82,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L82"},"def":{"name":"substitute_patterns","visibility":"Public","body":"default = @config_data_default[\"substitute_patterns\"]\n@config_data.fetch(\"substitute_patterns\", default)\n"}},{"html_id":"terminal_colors-instance-method","name":"terminal_colors","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":72,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L72"},"def":{"name":"terminal_colors","visibility":"Public","body":"default = @config_data_default[\"terminal_colors\"]\n@config_data.fetch(\"terminal_colors\", default)\n"}},{"html_id":"url_regex-instance-method","name":"url_regex","abstract":false,"location":{"filename":"src/chatgpt/config.cr","line_number":104,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L104"},"def":{"name":"url_regex","visibility":"Public","body":"Regex.new((pattern(:url))[\"pattern\"])"}}],"types":[{"html_id":"chatgpt-cli/ChatGPT/Config/ConfigData","path":"ChatGPT/Config/ConfigData.html","kind":"alias","full_name":"ChatGPT::Config::ConfigData","name":"ConfigData","abstract":false,"locations":[{"filename":"src/chatgpt/config.cr","line_number":17,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/config.cr#L17"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":true,"aliased":"Hash(String, Hash(String, Hash(String, String)))","aliased_html":"Hash(String, Hash(String, Hash(String, String)))","const":false,"namespace":{"html_id":"chatgpt-cli/ChatGPT/Config","kind":"class","full_name":"ChatGPT::Config","name":"Config"}}]},{"html_id":"chatgpt-cli/ChatGPT/InputSubstitutor","path":"ChatGPT/InputSubstitutor.html","kind":"class","full_name":"ChatGPT::InputSubstitutor","name":"InputSubstitutor","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/input_substitutor.cr","line_number":4,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/input_substitutor.cr#L4"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"constructors":[{"html_id":"new(system_command_runner:SystemCommandRunner)-class-method","name":"new","abstract":false,"args":[{"name":"system_command_runner","external_name":"system_command_runner","restriction":"SystemCommandRunner"}],"args_string":"(system_command_runner : SystemCommandRunner)","args_html":"(system_command_runner : <a href=\"../ChatGPT/SystemCommandRunner.html\">SystemCommandRunner</a>)","location":{"filename":"src/chatgpt/input_substitutor.cr","line_number":5,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/input_substitutor.cr#L5"},"def":{"name":"new","args":[{"name":"system_command_runner","external_name":"system_command_runner","restriction":"SystemCommandRunner"}],"visibility":"Public","body":"_ = allocate\n_.initialize(system_command_runner)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"command(input_msg,command_pattern)-instance-method","name":"command","abstract":false,"args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"command_pattern","external_name":"command_pattern","restriction":""}],"args_string":"(input_msg, command_pattern)","args_html":"(input_msg, command_pattern)","location":{"filename":"src/chatgpt/input_substitutor.cr","line_number":46,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/input_substitutor.cr#L46"},"def":{"name":"command","args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"command_pattern","external_name":"command_pattern","restriction":""}],"visibility":"Public","body":"input_msg.gsub(command_pattern) do |command_match|\n  command_pattern = $~[1].strip\n  command_output = `#{command_pattern}`\nend"}},{"html_id":"file(input_msg,file_pattern)-instance-method","name":"file","abstract":false,"args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"file_pattern","external_name":"file_pattern","restriction":""}],"args_string":"(input_msg, file_pattern)","args_html":"(input_msg, file_pattern)","location":{"filename":"src/chatgpt/input_substitutor.cr","line_number":53,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/input_substitutor.cr#L53"},"def":{"name":"file","args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"file_pattern","external_name":"file_pattern","restriction":""}],"visibility":"Public","body":"input_msg.gsub(file_pattern) do |file_match|\n  file_pattern = $~[1].strip\n  formatted_file_contents = get_formatted_file_contents(file_match, file_pattern)\n  if formatted_file_contents.is_a?(Array)\n    formatted_file_contents.join(\"\\n\")\n  else\n    formatted_file_contents\n  end\nend"}},{"html_id":"stderr(input_msg,stderr_pattern)-instance-method","name":"stderr","abstract":false,"args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"stderr_pattern","external_name":"stderr_pattern","restriction":""}],"args_string":"(input_msg, stderr_pattern)","args_html":"(input_msg, stderr_pattern)","location":{"filename":"src/chatgpt/input_substitutor.cr","line_number":32,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/input_substitutor.cr#L32"},"def":{"name":"stderr","args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"stderr_pattern","external_name":"stderr_pattern","restriction":""}],"visibility":"Public","body":"input_msg.gsub(stderr_pattern) do |stderr_match|\n  \"\\ncommand: `#{last_command}`\\n\\n```\\n#{last_stderr}\\n```\\n\"\nend"}},{"html_id":"stdout(input_msg,stdout_pattern)-instance-method","name":"stdout","abstract":false,"args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"stdout_pattern","external_name":"stdout_pattern","restriction":""}],"args_string":"(input_msg, stdout_pattern)","args_html":"(input_msg, stdout_pattern)","location":{"filename":"src/chatgpt/input_substitutor.cr","line_number":20,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/input_substitutor.cr#L20"},"def":{"name":"stdout","args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"stdout_pattern","external_name":"stdout_pattern","restriction":""}],"visibility":"Public","body":"input_msg.gsub(stdout_pattern) do |stdout_match|\n  \"\\n```\\n#{last_stdout}\\n```\\n\"\nend"}},{"html_id":"url(input_msg,url_pattern)-instance-method","name":"url","abstract":false,"args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"url_pattern","external_name":"url_pattern","restriction":""}],"args_string":"(input_msg, url_pattern)","args_html":"(input_msg, url_pattern)","location":{"filename":"src/chatgpt/input_substitutor.cr","line_number":65,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/input_substitutor.cr#L65"},"def":{"name":"url","args":[{"name":"input_msg","external_name":"input_msg","restriction":""},{"name":"url_pattern","external_name":"url_pattern","restriction":""}],"visibility":"Public","body":"input_msg.gsub(url_pattern) do |url_match|\n  url_pattern = $~[1].strip\n  fetch_and_compress_url_contents(url_match, url_pattern)\nend"}}]},{"html_id":"chatgpt-cli/ChatGPT/MagicCommandRunner","path":"ChatGPT/MagicCommandRunner.html","kind":"class","full_name":"ChatGPT::MagicCommandRunner","name":"MagicCommandRunner","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/magic_command_runner.cr","line_number":6,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L6"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"Table","name":"Table","value":"[{\"name\" => \"debug\", \"description\" => \"Toggle debug mode\", \"pattern\" => \"debug\", \"n_args\" => 0, \"method\" => \"debug_mode_toggle\"}, {\"name\" => \"model\", \"description\" => \"Show model name\", \"pattern\" => \"model\", \"n_args\" => 0, \"method\" => \"show_model_name\"}, {\"name\" => \"model <model_name>\", \"description\" => \"Set model name\", \"pattern\" => /^model\\s+(.+)/, \"n_args\" => 1, \"method\" => \"set_model_name\"}, {\"name\" => \"system\", \"description\" => \"Show system messages\", \"pattern\" => \"system\", \"n_args\" => 0, \"method\" => \"show_system_messages\"}, {\"name\" => \"system <message>\", \"description\" => \"Set system message\", \"pattern\" => /^system\\s+(.+)/, \"n_args\" => 1, \"method\" => \"set_system_messages\"}, {\"name\" => \"edit\", \"description\" => \"Show or edit data in JSON\", \"pattern\" => \"edit\", \"n_args\" => 0, \"method\" => \"edit_data_json\"}, {\"name\" => \"html\", \"description\" => \"Show data in the browser\", \"pattern\" => \"html\", \"n_args\" => 0, \"method\" => \"html_data\"}, {\"name\" => \"html <file_name>\", \"description\" => \"Save data to <file_name> and open in the browser\", \"pattern\" => /^html\\s+(.+)/, \"n_args\" => 1, \"method\" => \"html_data\"}, {\"name\" => \"clear\", \"description\" => \"Clear messages and initialize data\", \"pattern\" => \"clear\", \"n_args\" => 0, \"method\" => \"clear_messages\"}, {\"name\" => \"write <file_name> or w <file_name>\", \"description\" => \"Write last message to <file_name>\", \"pattern\" => /^[write,w]\\s+(.+)/, \"n_args\" => 1, \"method\" => \"write_to_file\"}, {\"name\" => \"undo\", \"description\" => \"Undo last message and response\", \"pattern\" => \"undo\", \"n_args\" => 0, \"method\" => \"undo\"}, {\"name\" => \"undo <n>\", \"description\" => \"Undo last <n> messages and responses\", \"pattern\" => /^undo\\s+(\\d+)/, \"n_args\" => 1, \"method\" => \"undo\"}, {\"name\" => \"resume\", \"description\" => \"Resume from auto-saved data\", \"pattern\" => \"resume\", \"n_args\" => 0, \"method\" => \"resume\"}, {\"name\" => \"save\", \"description\" => \"Save data to chatgpt-<timestamp>.json\", \"pattern\" => \"save\", \"n_args\" => 0, \"method\" => \"save_data_to_json\"}, {\"name\" => \"save <file_name>\", \"description\" => \"Save data to <file_name>\", \"pattern\" => /^save\\s+(.+)/, \"n_args\" => 1, \"method\" => \"save_data_to_json\"}, {\"name\" => \"load\", \"description\" => \"Load latest saved data from current directory\", \"pattern\" => \"load\", \"n_args\" => 0, \"method\" => \"load_data_from_json\"}, {\"name\" => \"load <file_name>\", \"description\" => \"Load data from <file_name>\", \"pattern\" => /^load\\s+(.+)/, \"n_args\" => 1, \"method\" => \"load_data_from_json\"}, {\"name\" => \"config\", \"description\" => \"Edit config file\", \"pattern\" => \"config\", \"n_args\" => 0, \"method\" => \"show_config\"}, {\"name\" => \"response\", \"description\" => \"Show last response in JSON\", \"pattern\" => \"response\", \"n_args\" => 0, \"method\" => \"show_response_json\"}, {\"name\" => \"tokens\", \"description\" => \"Show total tokens used\", \"pattern\" => /^tokens?\\s*$/, \"n_args\" => 0, \"method\" => \"show_total_tokens\"}, {\"name\" => \"history\", \"description\" => \"Show history\", \"pattern\" => \"history\", \"n_args\" => 0, \"method\" => \"show_history\"}, {\"name\" => \"webapp\", \"description\" => \"Open ChatGPT webapp\", \"pattern\" => \"webapp\", \"n_args\" => 0, \"method\" => \"open_webapp\"}, {\"name\" => \"help\", \"description\" => \"Show this help\", \"pattern\" => \"help\", \"n_args\" => 0, \"method\" => \"show_help\"}]"}],"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"constructors":[{"html_id":"new(data=nil,key:String=\"%\")-class-method","name":"new","abstract":false,"args":[{"name":"data","default_value":"nil","external_name":"data","restriction":""},{"name":"key","default_value":"\"%\"","external_name":"key","restriction":"::String"}],"args_string":"(data = nil, key : String = \"%\")","args_html":"(data = <span class=\"n\">nil</span>, key : String = <span class=\"s\">&quot;%&quot;</span>)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":177,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L177"},"def":{"name":"new","args":[{"name":"data","default_value":"nil","external_name":"data","restriction":""},{"name":"key","default_value":"\"%\"","external_name":"key","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(data, key)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"clear_messages-instance-method","name":"clear_messages","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":287,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L287"},"def":{"name":"clear_messages","visibility":"Public","body":"data.messages.clear\nputs(\"Cleared\"._colorize(:warning))\n@total_tokens = -1\ntrue\n"}},{"html_id":"data:PostData-instance-method","name":"data","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":173,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L173"},"def":{"name":"data","return_type":"PostData","visibility":"Public","body":"@data"}},{"html_id":"data=(data:PostData)-instance-method","name":"data=","abstract":false,"args":[{"name":"data","external_name":"data","restriction":"PostData"}],"args_string":"(data : PostData)","args_html":"(data : <a href=\"../ChatGPT/PostData.html\">PostData</a>)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":173,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L173"},"def":{"name":"data=","args":[{"name":"data","external_name":"data","restriction":"PostData"}],"visibility":"Public","body":"@data = data"}},{"html_id":"debug_mode_toggle-instance-method","name":"debug_mode_toggle","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":216,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L216"},"def":{"name":"debug_mode_toggle","visibility":"Public","body":"DEBUG_FLAG[0] = !DEBUG_FLAG[0]\nputs(\"Debug mode: #{DEBUG_FLAG[0]}\"._colorize(:warning))\ntrue\n"}},{"html_id":"edit_data_json-instance-method","name":"edit_data_json","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":255,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L255"},"def":{"name":"edit_data_json","visibility":"Public","body":"new_data = data\n(File.tempfile(\"chatgpt-cli\", \".json\") do |file|\n  File.write(file.path, data.to_pretty_json)\n  open_editor(file.path)\n  begin\n    new_data = PostData.from_json(File.read(file.path))\n    puts(\"Saved\"._colorize(:warning))\n  rescue\n    puts(\"Error: Invalid JSON\"._colorize(:warning, :bold))\n  end\nend).delete\n@data = new_data\n@total_tokens = -1\ntrue\n"}},{"html_id":"html_data(file_name)-instance-method","name":"html_data","abstract":false,"args":[{"name":"file_name","external_name":"file_name","restriction":""}],"args_string":"(file_name)","args_html":"(file_name)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":279,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L279"},"def":{"name":"html_data","args":[{"name":"file_name","external_name":"file_name","restriction":""}],"visibility":"Public","body":"html = (HtmlGenerator.new(data)).to_s\nFile.write(file_name, html)\nopen_browser(file_name)\ntrue\n"}},{"html_id":"html_data-instance-method","name":"html_data","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":272,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L272"},"def":{"name":"html_data","visibility":"Public","body":"html = (HtmlGenerator.new(data)).to_s\ntimestamp = Time.local.to_s(\"%Y%m%d-%H%M%S\")\nfile_name = \"chatgpt-#{timestamp}.html\"\nhtml_data(file_name)\n"}},{"html_id":"key:String-instance-method","name":"key","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":172,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L172"},"def":{"name":"key","return_type":"String","visibility":"Public","body":"@key"}},{"html_id":"load_data_from_json(file_name)-instance-method","name":"load_data_from_json","abstract":false,"args":[{"name":"file_name","external_name":"file_name","restriction":""}],"args_string":"(file_name)","args_html":"(file_name)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":345,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L345"},"def":{"name":"load_data_from_json","args":[{"name":"file_name","external_name":"file_name","restriction":""}],"visibility":"Public","body":"begin\n  new_data = PostData.from_json(File.read(file_name))\n  @data = new_data\n  puts(\"Loaded from #{file_name}\"._colorize(:warning))\nrescue\n  puts(\"Error: Invalid JSON\"._colorize(:warning, :bold))\nend\n@total_tokens = -1\ntrue\n"}},{"html_id":"load_data_from_json-instance-method","name":"load_data_from_json","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":335,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L335"},"def":{"name":"load_data_from_json","visibility":"Public","body":"file_names = Dir.glob(\"chatgpt-*.json\")\nif file_names.empty?\n  puts(\"Error: No saved data\"._colorize(:warning, :bold))\n  return true\nend\nload_data_from_json(file_names.sort.last)\ntrue\n"}},{"html_id":"next?:Bool-instance-method","name":"next?","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":195,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L195"},"def":{"name":"next?","visibility":"Public","body":"@next"}},{"html_id":"open_webapp-instance-method","name":"open_webapp","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":392,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L392"},"def":{"name":"open_webapp","visibility":"Public","body":"open_browser(\"https://chat.openai.com/\")\ntrue\n"}},{"html_id":"response_data:ResponseData-instance-method","name":"response_data","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":174,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L174"},"def":{"name":"response_data","return_type":"ResponseData","visibility":"Public","body":"@response_data"}},{"html_id":"resume-instance-method","name":"resume","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":294,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L294"},"def":{"name":"resume","visibility":"Public","body":"if File.exists?(Config::POST_DATA_FILE)\n  load_data_from_json(Config::POST_DATA_FILE)\nelse\n  puts(\"No saved data\"._colorize(:warning))\nend\n@total_tokens = -1\ntrue\n"}},{"html_id":"run(command:String,data:ChatGPT::PostData,response_data:ChatGPT::ResponseData):Bool-instance-method","name":"run","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"String"},{"name":"data","external_name":"data","restriction":"::ChatGPT::PostData"},{"name":"response_data","external_name":"response_data","restriction":"::ChatGPT::ResponseData"}],"args_string":"(command : String, data : ChatGPT::PostData, response_data : ChatGPT::ResponseData) : Bool","args_html":"(command : String, data : <a href=\"../ChatGPT/PostData.html\">ChatGPT::PostData</a>, response_data : <a href=\"../ChatGPT/ResponseData.html\">ChatGPT::ResponseData</a>) : Bool","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":199,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L199"},"def":{"name":"run","args":[{"name":"command","external_name":"command","restriction":"String"},{"name":"data","external_name":"data","restriction":"::ChatGPT::PostData"},{"name":"response_data","external_name":"response_data","restriction":"::ChatGPT::ResponseData"}],"return_type":"Bool","visibility":"Public","body":"@data = data\n@response_data = response_data\n{% if true %}\n      case command\n      {% for value in Table %}\n        when {{ value[\"pattern\"] }}\n        {% if value[\"n_args\"] == 0 %}\n          {{ value[\"method\"].id }}\n        {% else %}\n          {{ value[\"method\"].id }}($1)\n        {% end %}\n      {% end %}\n      else\n        unknown_command_error(command)\n      end\n      {% end %}\n"}},{"html_id":"save_data_to_json(file_name)-instance-method","name":"save_data_to_json","abstract":false,"args":[{"name":"file_name","external_name":"file_name","restriction":""}],"args_string":"(file_name)","args_html":"(file_name)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":329,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L329"},"def":{"name":"save_data_to_json","args":[{"name":"file_name","external_name":"file_name","restriction":""}],"visibility":"Public","body":"File.write(file_name, data.to_pretty_json)\nputs(\"Saved to #{file_name}\"._colorize(:warning))\ntrue\n"}},{"html_id":"save_data_to_json-instance-method","name":"save_data_to_json","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":322,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L322"},"def":{"name":"save_data_to_json","visibility":"Public","body":"timestamp = Time.local.to_s(\"%Y%m%d-%H%M%S\")\nfile_name = \"chatgpt-#{timestamp}.json\"\nsave_data_to_json(file_name)\ntrue\n"}},{"html_id":"set_model_name(model_name)-instance-method","name":"set_model_name","abstract":false,"args":[{"name":"model_name","external_name":"model_name","restriction":""}],"args_string":"(model_name)","args_html":"(model_name)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":227,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L227"},"def":{"name":"set_model_name","args":[{"name":"model_name","external_name":"model_name","restriction":""}],"visibility":"Public","body":"data.model = model_name\nputs(\"Set model to #{model_name}\"._colorize(:warning))\ntrue\n"}},{"html_id":"set_system_messages(message)-instance-method","name":"set_system_messages","abstract":false,"args":[{"name":"message","external_name":"message","restriction":""}],"args_string":"(message)","args_html":"(message)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":242,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L242"},"def":{"name":"set_system_messages","args":[{"name":"message","external_name":"message","restriction":""}],"visibility":"Public","body":"if data.messages.empty?\n  data.add_message(\"system\", message)\nelse\n  if data.messages[0][\"role\"] == \"system\"\n    data.messages[0][\"content\"] = message\n  else\n    data.messages.unshift({\"role\" => \"system\", \"content\" => message})\n  end\nend\nputs(\"Set system message to #{message}\"._colorize(:warning))\n@total_tokens = -1\ntrue\n"}},{"html_id":"show_config-instance-method","name":"show_config","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":387,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L387"},"def":{"name":"show_config","visibility":"Public","body":"open_editor(Config::CONFIG_FILE)\ntrue\n"}},{"html_id":"show_help-instance-method","name":"show_help","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":397,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L397"},"def":{"name":"show_help","visibility":"Public","body":"puts(\"Magic commands:\"._colorize(:warning, :bold))\nTable.each do |value|\n  puts(\"  % #{value[\"name\"]}\"._colorize(:warning, :bold))\n  puts(\"    #{value[\"description\"]}\"._colorize(:warning))\nend\ntrue\n"}},{"html_id":"show_history-instance-method","name":"show_history","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":382,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L382"},"def":{"name":"show_history","visibility":"Public","body":"open_editor(Config::HISTORY_FILE)\ntrue\n"}},{"html_id":"show_model_name-instance-method","name":"show_model_name","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":222,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L222"},"def":{"name":"show_model_name","visibility":"Public","body":"puts(\"Model: #{data.model}\"._colorize(:warning))\ntrue\n"}},{"html_id":"show_response_json-instance-method","name":"show_response_json","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":364,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L364"},"def":{"name":"show_response_json","visibility":"Public","body":"(File.tempfile(\"chatgpt-cli\", \".json\") do |file|\n  File.write(file.path, response_data.to_pretty_json)\n  open_editor(file.path)\nend).delete\ntrue\n"}},{"html_id":"show_system_messages-instance-method","name":"show_system_messages","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":233,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L233"},"def":{"name":"show_system_messages","visibility":"Public","body":"data.messages.each do |msg|\n  if msg[\"role\"] == \"system\"\n    puts(msg[\"content\"]._colorize(:warning))\n  end\nend\ntrue\n"}},{"html_id":"show_total_tokens-instance-method","name":"show_total_tokens","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":372,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L372"},"def":{"name":"show_total_tokens","visibility":"Public","body":"begin\n  tokens = response_data.tokens\nrescue ex\n  tokens = \"Unknown\"\nend\nputs(\"#{tokens}\"._colorize(:warning))\ntrue\n"}},{"html_id":"total_tokens:Int32-instance-method","name":"total_tokens","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":175,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L175"},"def":{"name":"total_tokens","return_type":"Int32","visibility":"Public","body":"@total_tokens"}},{"html_id":"try_run(msg,data,response_data,total_tokens:Int32)-instance-method","name":"try_run","abstract":false,"args":[{"name":"msg","external_name":"msg","restriction":""},{"name":"data","external_name":"data","restriction":""},{"name":"response_data","external_name":"response_data","restriction":""},{"name":"total_tokens","external_name":"total_tokens","restriction":"::Int32"}],"args_string":"(msg, data, response_data, total_tokens : Int32)","args_html":"(msg, data, response_data, total_tokens : Int32)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":184,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L184"},"def":{"name":"try_run","args":[{"name":"msg","external_name":"msg","restriction":""},{"name":"data","external_name":"data","restriction":""},{"name":"response_data","external_name":"response_data","restriction":""},{"name":"total_tokens","external_name":"total_tokens","restriction":"::Int32"}],"visibility":"Public","body":"@total_tokens = total_tokens\nif (/^%(?!\\{|#{key})/).match(msg)\n  cmd = msg[1..-1].strip\n  @next = run(cmd, data, response_data)\n  true\nelse\n  false\nend\n"}},{"html_id":"undo(n)-instance-method","name":"undo","abstract":false,"args":[{"name":"n","external_name":"n","restriction":""}],"args_string":"(n)","args_html":"(n)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":310,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L310"},"def":{"name":"undo","args":[{"name":"n","external_name":"n","restriction":""}],"visibility":"Public","body":"number_of_user_messages = data.count_user_messages\nn = [n.to_i, number_of_user_messages].min\nn.times do\n  data.messages.pop\n  data.messages.pop\nend\nputs(\"Undo #{n == 1 ? \"last\" : n} messages\"._colorize(:warning))\n@total_tokens = -1\ntrue\n"}},{"html_id":"undo-instance-method","name":"undo","abstract":false,"location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":304,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L304"},"def":{"name":"undo","visibility":"Public","body":"undo(1)\n@total_tokens = -1\ntrue\n"}},{"html_id":"unknown_command_error(command)-instance-method","name":"unknown_command_error","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":406,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L406"},"def":{"name":"unknown_command_error","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"STDERR.puts(\"Error: Unknown magic command: #{command}\"._colorize(:warning, :bold))\ntrue\n"}},{"html_id":"write_to_file(file_name)-instance-method","name":"write_to_file","abstract":false,"args":[{"name":"file_name","external_name":"file_name","restriction":""}],"args_string":"(file_name)","args_html":"(file_name)","location":{"filename":"src/chatgpt/magic_command_runner.cr","line_number":357,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/magic_command_runner.cr#L357"},"def":{"name":"write_to_file","args":[{"name":"file_name","external_name":"file_name","restriction":""}],"visibility":"Public","body":"last_response = (data.messages.dig?(-1, \"content\")).to_s\nFile.write(file_name, last_response)\nputs(\"Writed to #{file_name}\"._colorize(:warning))\ntrue\n"}}]},{"html_id":"chatgpt-cli/ChatGPT/PostData","path":"ChatGPT/PostData.html","kind":"struct","full_name":"ChatGPT::PostData","name":"PostData","abstract":false,"superclass":{"html_id":"chatgpt-cli/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"chatgpt-cli/JSON/Serializable","kind":"module","full_name":"JSON::Serializable","name":"Serializable"},{"html_id":"chatgpt-cli/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"chatgpt-cli/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/post_data.cr","line_number":4,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L4"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"chatgpt-cli/JSON/Serializable","kind":"module","full_name":"JSON::Serializable","name":"Serializable"}],"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"constructors":[{"html_id":"new(pull:JSON::PullParser)-class-method","name":"new","abstract":false,"args":[{"name":"pull","external_name":"pull","restriction":"::JSON::PullParser"}],"args_string":"(pull : JSON::PullParser)","args_html":"(pull : JSON::PullParser)","location":{"filename":"src/chatgpt/post_data.cr","line_number":5,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L5"},"def":{"name":"new","args":[{"name":"pull","external_name":"pull","restriction":"::JSON::PullParser"}],"visibility":"Public","body":"new_from_json_pull_parser(pull)"}},{"html_id":"new(model:String=\"gpt-3.5-turbo\",messages:Array(Hash(String,String))=[]ofHash(String,String),n:Int32=1,temperature:Float64=1.0,top_p:Float64=1.0)-class-method","name":"new","abstract":false,"args":[{"name":"model","default_value":"\"gpt-3.5-turbo\"","external_name":"model","restriction":"::String"},{"name":"messages","default_value":"[] of Hash(String, String)","external_name":"messages","restriction":"::Array(::Hash(::String, ::String))"},{"name":"n","default_value":"1","external_name":"n","restriction":"::Int32"},{"name":"temperature","default_value":"1.0","external_name":"temperature","restriction":"::Float64"},{"name":"top_p","default_value":"1.0","external_name":"top_p","restriction":"::Float64"}],"args_string":"(model : String = \"gpt-3.5-turbo\", messages : Array(Hash(String, String)) = [] of Hash(String, String), n : Int32 = 1, temperature : Float64 = 1.0, top_p : Float64 = 1.0)","args_html":"(model : String = <span class=\"s\">&quot;gpt-3.5-turbo&quot;</span>, messages : Array(Hash(String, String)) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">Hash</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>), n : Int32 = <span class=\"n\">1</span>, temperature : Float64 = <span class=\"n\">1.0</span>, top_p : Float64 = <span class=\"n\">1.0</span>)","location":{"filename":"src/chatgpt/post_data.cr","line_number":12,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L12"},"def":{"name":"new","args":[{"name":"model","default_value":"\"gpt-3.5-turbo\"","external_name":"model","restriction":"::String"},{"name":"messages","default_value":"[] of Hash(String, String)","external_name":"messages","restriction":"::Array(::Hash(::String, ::String))"},{"name":"n","default_value":"1","external_name":"n","restriction":"::Int32"},{"name":"temperature","default_value":"1.0","external_name":"temperature","restriction":"::Float64"},{"name":"top_p","default_value":"1.0","external_name":"top_p","restriction":"::Float64"}],"visibility":"Public","body":"_ = allocate\n_.initialize(model, messages, n, temperature, top_p)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"add_message(role:String,content:String)-instance-method","name":"add_message","abstract":false,"args":[{"name":"role","external_name":"role","restriction":"String"},{"name":"content","external_name":"content","restriction":"String"}],"args_string":"(role : String, content : String)","args_html":"(role : String, content : String)","location":{"filename":"src/chatgpt/post_data.cr","line_number":29,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L29"},"def":{"name":"add_message","args":[{"name":"role","external_name":"role","restriction":"String"},{"name":"content","external_name":"content","restriction":"String"}],"visibility":"Public","body":"@messages << {\"role\" => role, \"content\" => content}"}},{"html_id":"count_user_messages-instance-method","name":"count_user_messages","abstract":false,"location":{"filename":"src/chatgpt/post_data.cr","line_number":21,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L21"},"def":{"name":"count_user_messages","visibility":"Public","body":"user_messages.size"}},{"html_id":"messages:Array(Hash(String,String))-instance-method","name":"messages","abstract":false,"location":{"filename":"src/chatgpt/post_data.cr","line_number":7,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L7"},"def":{"name":"messages","return_type":"Array(Hash(String, String))","visibility":"Public","body":"@messages"}},{"html_id":"messages=(messages:Array(Hash(String,String)))-instance-method","name":"messages=","abstract":false,"args":[{"name":"messages","external_name":"messages","restriction":"Array(Hash(String, String))"}],"args_string":"(messages : Array(Hash(String, String)))","args_html":"(messages : Array(Hash(String, String)))","location":{"filename":"src/chatgpt/post_data.cr","line_number":7,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L7"},"def":{"name":"messages=","args":[{"name":"messages","external_name":"messages","restriction":"Array(Hash(String, String))"}],"visibility":"Public","body":"@messages = messages"}},{"html_id":"model:String-instance-method","name":"model","abstract":false,"location":{"filename":"src/chatgpt/post_data.cr","line_number":6,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L6"},"def":{"name":"model","return_type":"String","visibility":"Public","body":"@model"}},{"html_id":"model=(model:String)-instance-method","name":"model=","abstract":false,"args":[{"name":"model","external_name":"model","restriction":"String"}],"args_string":"(model : String)","args_html":"(model : String)","location":{"filename":"src/chatgpt/post_data.cr","line_number":6,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L6"},"def":{"name":"model=","args":[{"name":"model","external_name":"model","restriction":"String"}],"visibility":"Public","body":"@model = model"}},{"html_id":"n:Int32-instance-method","name":"n","abstract":false,"location":{"filename":"src/chatgpt/post_data.cr","line_number":10,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L10"},"def":{"name":"n","return_type":"Int32","visibility":"Public","body":"@n"}},{"html_id":"n=(n:Int32)-instance-method","name":"n=","abstract":false,"args":[{"name":"n","external_name":"n","restriction":"Int32"}],"args_string":"(n : Int32)","args_html":"(n : Int32)","location":{"filename":"src/chatgpt/post_data.cr","line_number":10,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L10"},"def":{"name":"n=","args":[{"name":"n","external_name":"n","restriction":"Int32"}],"visibility":"Public","body":"@n = n"}},{"html_id":"temperature:Float64-instance-method","name":"temperature","abstract":false,"location":{"filename":"src/chatgpt/post_data.cr","line_number":8,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L8"},"def":{"name":"temperature","return_type":"Float64","visibility":"Public","body":"@temperature"}},{"html_id":"temperature=(temperature:Float64)-instance-method","name":"temperature=","abstract":false,"args":[{"name":"temperature","external_name":"temperature","restriction":"Float64"}],"args_string":"(temperature : Float64)","args_html":"(temperature : Float64)","location":{"filename":"src/chatgpt/post_data.cr","line_number":8,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L8"},"def":{"name":"temperature=","args":[{"name":"temperature","external_name":"temperature","restriction":"Float64"}],"visibility":"Public","body":"@temperature = temperature"}},{"html_id":"top_p:Float64-instance-method","name":"top_p","abstract":false,"location":{"filename":"src/chatgpt/post_data.cr","line_number":9,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L9"},"def":{"name":"top_p","return_type":"Float64","visibility":"Public","body":"@top_p"}},{"html_id":"top_p=(top_p:Float64)-instance-method","name":"top_p=","abstract":false,"args":[{"name":"top_p","external_name":"top_p","restriction":"Float64"}],"args_string":"(top_p : Float64)","args_html":"(top_p : Float64)","location":{"filename":"src/chatgpt/post_data.cr","line_number":9,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L9"},"def":{"name":"top_p=","args":[{"name":"top_p","external_name":"top_p","restriction":"Float64"}],"visibility":"Public","body":"@top_p = top_p"}},{"html_id":"user_messages-instance-method","name":"user_messages","abstract":false,"location":{"filename":"src/chatgpt/post_data.cr","line_number":25,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/post_data.cr#L25"},"def":{"name":"user_messages","visibility":"Public","body":"@messages.select do |msg|\n  msg[\"role\"] == \"user\"\nend"}}]},{"html_id":"chatgpt-cli/ChatGPT/ResponseData","path":"ChatGPT/ResponseData.html","kind":"class","full_name":"ChatGPT::ResponseData","name":"ResponseData","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/response_data.cr","line_number":4,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/response_data.cr#L4"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"constructors":[{"html_id":"new(data)-class-method","name":"new","abstract":false,"args":[{"name":"data","external_name":"data","restriction":""}],"args_string":"(data)","args_html":"(data)","location":{"filename":"src/chatgpt/response_data.cr","line_number":5,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/response_data.cr#L5"},"def":{"name":"new","args":[{"name":"data","external_name":"data","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(data)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"assistant_message-instance-method","name":"assistant_message","abstract":false,"location":{"filename":"src/chatgpt/response_data.cr","line_number":21,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/response_data.cr#L21"},"def":{"name":"assistant_message","visibility":"Public","body":"(@data.dig(\"choices\", 0, \"message\", \"content\")).to_s"}},{"html_id":"to_pretty_json-instance-method","name":"to_pretty_json","abstract":false,"location":{"filename":"src/chatgpt/response_data.cr","line_number":17,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/response_data.cr#L17"},"def":{"name":"to_pretty_json","visibility":"Public","body":"@data.to_pretty_json"}},{"html_id":"tokens-instance-method","name":"tokens","abstract":false,"location":{"filename":"src/chatgpt/response_data.cr","line_number":9,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/response_data.cr#L9"},"def":{"name":"tokens","visibility":"Public","body":"(@data.dig(\"usage\")).to_pretty_json"}},{"html_id":"total_tokens-instance-method","name":"total_tokens","abstract":false,"location":{"filename":"src/chatgpt/response_data.cr","line_number":13,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/response_data.cr#L13"},"def":{"name":"total_tokens","visibility":"Public","body":"(@data.dig(\"usage\", \"total_tokens\")).to_s.to_i"}}]},{"html_id":"chatgpt-cli/ChatGPT/SigIntError","path":"ChatGPT/SigIntError.html","kind":"class","full_name":"ChatGPT::SigIntError","name":"SigIntError","abstract":false,"superclass":{"html_id":"chatgpt-cli/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"chatgpt-cli/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/client.cr","line_number":6,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/client.cr#L6"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"}},{"html_id":"chatgpt-cli/ChatGPT/SystemCommandRunner","path":"ChatGPT/SystemCommandRunner.html","kind":"class","full_name":"ChatGPT::SystemCommandRunner","name":"SystemCommandRunner","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/system_command_runner.cr","line_number":2,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/system_command_runner.cr#L2"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/chatgpt/system_command_runner.cr","line_number":7,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/system_command_runner.cr#L7"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"last_command:String-instance-method","name":"last_command","abstract":false,"location":{"filename":"src/chatgpt/system_command_runner.cr","line_number":5,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/system_command_runner.cr#L5"},"def":{"name":"last_command","visibility":"Public","body":"@last_command"}},{"html_id":"last_stderr:String-instance-method","name":"last_stderr","abstract":false,"location":{"filename":"src/chatgpt/system_command_runner.cr","line_number":4,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/system_command_runner.cr#L4"},"def":{"name":"last_stderr","visibility":"Public","body":"@last_stderr"}},{"html_id":"last_stdout:String-instance-method","name":"last_stdout","abstract":false,"location":{"filename":"src/chatgpt/system_command_runner.cr","line_number":3,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/system_command_runner.cr#L3"},"def":{"name":"last_stdout","visibility":"Public","body":"@last_stdout"}},{"html_id":"try_run(input_message)-instance-method","name":"try_run","abstract":false,"args":[{"name":"input_message","external_name":"input_message","restriction":""}],"args_string":"(input_message)","args_html":"(input_message)","location":{"filename":"src/chatgpt/system_command_runner.cr","line_number":13,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/system_command_runner.cr#L13"},"def":{"name":"try_run","args":[{"name":"input_message","external_name":"input_message","restriction":""}],"visibility":"Public","body":"if input_message.starts_with?(\"!\")\nelse\n  return false\nend\nif input_message.starts_with?(\"!!\")\n  run(input_message[2..-1].strip, record: true)\nelse\n  run(input_message[1..-1].strip, record: false)\nend\ntrue\n"}}]},{"html_id":"chatgpt-cli/ChatGPT/WebPageCompressor","path":"ChatGPT/WebPageCompressor.html","kind":"class","full_name":"ChatGPT::WebPageCompressor","name":"WebPageCompressor","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/webpage_compressor.cr","line_number":8,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/webpage_compressor.cr#L8"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/ChatGPT","kind":"module","full_name":"ChatGPT","name":"ChatGPT"},"constructors":[{"html_id":"new(url:String)-class-method","name":"new","abstract":false,"args":[{"name":"url","external_name":"url","restriction":"String"}],"args_string":"(url : String)","args_html":"(url : String)","location":{"filename":"src/chatgpt/webpage_compressor.cr","line_number":9,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/webpage_compressor.cr#L9"},"def":{"name":"new","args":[{"name":"url","external_name":"url","restriction":"String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(url)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"compressed_text-instance-method","name":"compressed_text","abstract":false,"location":{"filename":"src/chatgpt/webpage_compressor.cr","line_number":13,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/webpage_compressor.cr#L13"},"def":{"name":"compressed_text","visibility":"Public","body":"res = HTTP::Client.get(@uri)\nbody = res.body.to_s\n(words(Lexbor::Parser.new(body))).join(\"|\")\n"}},{"html_id":"words(parser)-instance-method","name":"words","abstract":false,"args":[{"name":"parser","external_name":"parser","restriction":""}],"args_string":"(parser)","args_html":"(parser)","location":{"filename":"src/chatgpt/webpage_compressor.cr","line_number":19,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/webpage_compressor.cr#L19"},"def":{"name":"words","args":[{"name":"parser","external_name":"parser","restriction":""}],"visibility":"Public","body":"(parser.nodes(:_text)).select do |__arg0|\n  __arg0.parents.all?(&.displayble?)\nend.map(&.tag_text).reject(&.blank?).map do |__arg4|\n  __arg4.strip.gsub(/\\s{2,}/, \" \")\nend"}}]}]},{"html_id":"chatgpt-cli/HtmlGenerator","path":"HtmlGenerator.html","kind":"class","full_name":"HtmlGenerator","name":"HtmlGenerator","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/html_generator.cr","line_number":4,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L4"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"constructors":[{"html_id":"new(data)-class-method","name":"new","abstract":false,"args":[{"name":"data","external_name":"data","restriction":""}],"args_string":"(data)","args_html":"(data)","location":{"filename":"src/chatgpt/html_generator.cr","line_number":50,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L50"},"def":{"name":"new","args":[{"name":"data","external_name":"data","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(data)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"to_s(__io__:IO):Nil-instance-method","name":"to_s","doc":"Appends a short String representation of this object\nwhich includes its class name and its object address.\n\n```\nclass Person\n  def initialize(@name : String, @age : Int32)\n  end\nend\n\nPerson.new(\"John\", 32).to_s # => #<Person:0x10a199f20>\n```","summary":"<p>Appends a short String representation of this object which includes its class name and its object address.</p>","abstract":false,"args":[{"name":"__io__","external_name":"__io__","restriction":"IO"}],"args_string":"(__io__ : IO) : Nil","args_html":"(__io__ : IO) : Nil","location":{"filename":"src/chatgpt/html_generator.cr","line_number":56,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L56"},"def":{"name":"to_s","args":[{"name":"__io__","external_name":"__io__","restriction":"IO"}],"return_type":"Nil","visibility":"Public","body":"ECR.embed(\"/home/runner/work/chatgpt-cli/chatgpt-cli/src/chatgpt/output.html.ecr\", \"__io__\")"}}],"types":[{"html_id":"chatgpt-cli/HtmlGenerator/HtmlGenerationError","path":"HtmlGenerator/HtmlGenerationError.html","kind":"class","full_name":"HtmlGenerator::HtmlGenerationError","name":"HtmlGenerationError","abstract":false,"superclass":{"html_id":"chatgpt-cli/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"chatgpt-cli/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/html_generator.cr","line_number":5,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L5"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/HtmlGenerator","kind":"class","full_name":"HtmlGenerator","name":"HtmlGenerator"}},{"html_id":"chatgpt-cli/HtmlGenerator/Message","path":"HtmlGenerator/Message.html","kind":"class","full_name":"HtmlGenerator::Message","name":"Message","abstract":false,"superclass":{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"chatgpt-cli/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"chatgpt-cli/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/chatgpt/html_generator.cr","line_number":7,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L7"}],"repository_name":"chatgpt-cli","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"chatgpt-cli/HtmlGenerator","kind":"class","full_name":"HtmlGenerator","name":"HtmlGenerator"},"constructors":[{"html_id":"new(message:Hash(String,String))-class-method","name":"new","abstract":false,"args":[{"name":"message","external_name":"message","restriction":"::Hash(::String, ::String)"}],"args_string":"(message : Hash(String, String))","args_html":"(message : Hash(String, String))","location":{"filename":"src/chatgpt/html_generator.cr","line_number":10,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L10"},"def":{"name":"new","args":[{"name":"message","external_name":"message","restriction":"::Hash(::String, ::String)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(message)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"html_id":"avatar_class-instance-method","name":"avatar_class","abstract":false,"location":{"filename":"src/chatgpt/html_generator.cr","line_number":21,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L21"},"def":{"name":"avatar_class","visibility":"Public","body":"case role\nwhen \"user\", \"system\"\n  \"avatar human\"\nwhen \"assistant\"\n  \"avatar gpt\"\nelse\n  raise(HtmlGenerationError.new(\"Unknown role: #{role}\"))\nend"}},{"html_id":"avatar_image-instance-method","name":"avatar_image","abstract":false,"location":{"filename":"src/chatgpt/html_generator.cr","line_number":43,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L43"},"def":{"name":"avatar_image","visibility":"Public","body":"raise(NotImplementedError)"}},{"html_id":"content-instance-method","name":"content","abstract":false,"location":{"filename":"src/chatgpt/html_generator.cr","line_number":17,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L17"},"def":{"name":"content","visibility":"Public","body":"HTML.escape(@message[\"content\"])"}},{"html_id":"direction-instance-method","name":"direction","abstract":false,"location":{"filename":"src/chatgpt/html_generator.cr","line_number":32,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L32"},"def":{"name":"direction","visibility":"Public","body":"case role\nwhen \"user\", \"system\"\n  \"from\"\nwhen \"assistant\"\n  \"to\"\nelse\n  raise(HtmlGenerationError.new(\"Unknown role: #{role}\"))\nend"}},{"html_id":"role-instance-method","name":"role","abstract":false,"location":{"filename":"src/chatgpt/html_generator.cr","line_number":13,"url":"https://github.com/kojix2/chatgpt-cli/blob/9b638e7dc86858e7a85ef2e6ecbdd7122a6e5e84/src/chatgpt/html_generator.cr#L13"},"def":{"name":"role","visibility":"Public","body":"@message[\"role\"]"}}]}]}]}})